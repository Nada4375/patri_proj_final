<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Dashboard Patrimoine</title>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='cssrapport.css') }}">
</head>

<body>

    <!-- BOUTON MENU -->
    <div class="menu-btn" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
    </div>

    <!-- SIDEBAR -->
    <div id="sidebar" class="sidebar mini">

        <div class="sidebar-header">

            <button class="close-btn" onclick="toggleSidebar()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div class="menu-top">
            <div class="item" onclick="window.location.href='/index'">
                <i class="fa-solid fa-house"></i>
                <p>Accueil</p>
            </div>

            <div class="item active" onclick="window.location.href='/rapports'">
                <i class="fa-solid fa-chart-line"></i>
                <p>Dashboard Analyse</p>
            </div>

            <div class="item" onclick="window.location.href='/maintenance'">
                <i class="fa-solid fa-screwdriver-wrench"></i>
                <p>Maintenance</p>
            </div>

            <div class="item" onclick="window.location.href='/support'">
                <i class="fa-solid fa-headset"></i>
                <p>Support</p>
            </div>
        </div>
    </div>

    <!-- OVERLAY -->
    <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

    <!-- CONTENU -->
    <div class="content">

        <h1 class="dashboard-title"> Rapport</h1>

        <!-- FILTRE -->
        <div class="filter-card">
            <h2>Filtrer les données par année</h2>
            <form method="get" action="/rapports">
                <input type="number" name="annee" value="{{ annee }}" placeholder="Année">
                <button type="submit" class="btn-primary">Filtrer</button>
            </form>
        </div>

        <!-- CARTES -->
        <div class="stats-grid">

            <div class="stat-card" id="batiment-restaure">
                <i class="fa-solid fa-building"></i>
                <h3>{{ restaures|length }}</h3>
                <p>Bâtiments restaurés</p>
            </div>

            <div class="stat-card" id="batiment-en-mauvaisetat">
                <i class="fa-solid fa-circle-exclamation"></i>
                <h3>{{ mauvais|length }}</h3>
                <p>Bâtiments en mauvais état</p>
            </div>

        </div>

        <!-- GRAPHE -->
        <div class="chart-card">
            <h2>Évolution annuelle des restaurations</h2>
            <img src="data:image/png;base64,{{ graph_image }}" alt="Histogramme des restaurations"
                style="width:100%; max-width:700px; display:block; margin:auto;">
        </div>


        <!-- SECTIONS -->
        <div class="section-grid">

            <div class="section-card" id="intervention">
                <h2>Interventions par entreprise</h2>
                <ul>
                    {% for p in interventions %}
                    <li><span>{{ p[0] }}</span><strong>{{ p[1] }}</strong></li>
                    {% endfor %}
                </ul>
            </div>

            <div class="section-card" id="totale-quartuier">
                <h2>Coût total par quartier</h2>
                <ul>
                    {% for z in cout_quartier %}
                    <li><span>{{ z[0] }}</span><strong>{{ z[1] }} DH</strong></li>
                    {% endfor %}
                </ul>
            </div>

            <div class="section-card" id="P3">
                <h2>Prestataires (> 3 chantiers)</h2>
                <ul>
                    {% for p in prestataires %}
                    <li><span>{{ p[0] }}</span><strong>{{ p[1] }}</strong></li>
                    {% endfor %}
                </ul>
            </div>

        </div>
    </div>


    <!-- ================= JS ================= -->

    <!-- Toggle Sidebar -->
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("overlay");
            const content = document.querySelector(".content");

            sidebar.classList.toggle("open");
            overlay.classList.toggle("active");
            content.classList.toggle("blur-active");
        }
    </script>


</body>

</html>