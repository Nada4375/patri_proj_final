<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title> Gestion Patrimoine </title>

    <!-- CSS Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <!-- Ton CSS Flask -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">




</head>

<body>
    <div id="page-content">
        <header>
            <span id="ci">Rabat ‚Äì Syst√®me d'information urbain</span>
            <h1><span id="span">üó∫</span> Cartographie du patrimoine de Rabat</h1>
            <p>Monuments, b√¢timents administratifs et jardins</p>
        </header>

        <div id="contenu-principale">
            <!-- Boutons de filtre de la CARTE -->
            <div class="map-filter-group">

                <label class="filter-item">
                    <input type="radio" name="filter" value="all" checked>
                    <div class="circle">
                        <span class="material-icons-round">public</span>
                    </div>
                    <span>Tout afficher</span>
                </label>

                <label class="filter-item">
                    <input type="radio" name="filter" value="monuments">
                    <div class="circle">
                        <span class="material-icons-round">account_balance</span>
                    </div>
                    <span>Monuments</span>
                </label>

                <label class="filter-item">
                    <input type="radio" name="filter" value="batiments">
                    <div class="circle">
                        <span class="material-icons-round">apartment</span>
                    </div>
                    <span>B√¢timents</span>
                </label>

                <label class="filter-item">
                    <input type="radio" name="filter" value="jardins">
                    <div class="circle">
                        <span class="material-icons-round">park</span>
                    </div>
                    <span>Jardins</span>
                </label>
            </div>


            <!-- Conteneur de la carte -->
            <div id="map"></div>
            <!-- ========= MENU PRINCIPAL DES SECTIONS ========= -->
            <div class="dashboard-groups">

                <!-- Groupe 1 -->
                <div class="group-card" id="group1">
                    <h3>Gestion du Patrimoine</h3>

                    <div class="menu-sections" id="g1menu">

                        <a href="#form-zone"><button onclick="openSection('zones')">
                                <span class="material-icons-round">public</span>
                                <strong>Zones</strong>
                                <p>Gestion des zones g√©ographiques</p>
                            </button></a>

                        <a href="#form-proprietaire"><button onclick="openSection('proprietaires')">
                                <span class="material-icons-round">person</span>
                                <strong>Propri√©taires</strong>
                                <p>Liste et suivi des propri√©taires</p>
                            </button></a>

                        <a href="#form-type"><button onclick="openSection('types')">
                                <span class="material-icons-round">warehouse</span>
                                <strong>Types de B√¢timent</strong>
                                <p>Cat√©gories de b√¢timents</p>
                            </button></a>

                        <a href="#form-batiment"><button onclick="openSection('batiments')">
                                <span class="material-icons-round">location_city</span>
                                <strong>B√¢timents</strong>
                                <p>Ensemble des b√¢timents</p>
                            </button></a>

                    </div>
                </div>


                <!-- Groupe 2 -->
                <div class="group-card" id="group2">
                    <h3>Activit√©s & Interventions</h3>

                    <div class="menu-sections" id="g2menu">

                        <a href="#form-prestataire"><button onclick="openSection('prestataires')">
                                <span class="material-icons-round">handyman</span>
                                <strong>Prestataires</strong>
                                <p>Partenaires & services</p>
                            </button></a>

                        <a href="#form-intervention"><button onclick="openSection('interventions')">
                                <span class="material-icons-round">construction</span>
                                <strong>Interventions</strong>
                                <p>Travaux & op√©rations</p>
                            </button></a>

                        <a href="#form-inspection"><button onclick="openSection('inspections')">
                                <span class="material-icons-round">search</span>
                                <strong>Inspections</strong>
                                <p>Contr√¥les & observations</p>
                            </button></a>

                    </div>
                </div>


                <!-- Groupe 3 -->
                <div class="group-card" id="group3">
                    <h3>Documents & √âtats</h3>

                    <div class="menu-sections">

                        <a href="#form-document" id="g3menu"><button onclick="openSection('documents')">
                                <div id="g3menu"><span class="material-icons-round">description</span>
                                    <strong>Documents</strong>
                                    <p>Pi√®ces, rapports & fichiers</p>
                                </div>
                            </button></a>

                        <a href="#etat_conservation" id="g3menu"><button onclick="openSection('etat_conservation')">
                                <span class="material-icons-round">inventory</span>
                                <strong>√âtat de Conservation</strong>
                                <p>Qualit√© & conservation</p>
                            </button></a>

                    </div>
                </div>

            </div>

            <!-- ========= SECTIONS CONTENU ========= -->

            <!-- ZONES -->
            <section id="zones" class="content-section" style="display:none;">
                <h2>Gestion des Zones</h2>

                <form action="/add_zone" method="POST" id="form-zone">

                    <input type="hidden" name="id_zone" id="zone_id">

                    <label>Nom Zone :</label>
                    <input type="text" name="nom_zone" id="zone_nom" required>

                    <button type="submit" id="zone_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Zones</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Modefier</th>
                        <th>Supprimer</th>
                    </tr>

                    {% for z in zones %}
                    <tr>
                        <td>{{ z[0] }}</td>
                        <td>{{ z[1] }}</td>
                        <td>
                            <a href="#" onclick="editZone('{{ z[0] }}','{{ z[1] }}')"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>

                        <td>
                            <a href="/delete_zone/{{ z[0] }}" onclick="return confirmDelete();" class="delete-btn"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>


                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- TYPES DE BATIMENT -->
            <section id="types" class="content-section" style="display:none;">
                <h2>Gestion des Types de B√¢timent</h2>
                <form action="/add_type" method="POST" id="form-type">

                    <!-- utilis√© seulement pour modification -->
                    <input type="hidden" name="id_type" id="type_id">

                    <label>Libell√© :</label>
                    <input type="text" name="libelle" id="type_libelle" required><br>

                    <button type="submit" id="type_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Types</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Libell√©</th>
                        <th>Modefier</th>
                        <th>Supprimer</th>
                    </tr>

                    {% for t in types %}
                    <tr>
                        <td>{{ t[0] }}</td>
                        <td>{{ t[1] }}</td>
                        <td>
                            <a href="#" onclick="editType('{{ t[0] }}','{{ t[1] }}')"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>
                        <td>
                            <a href="/delete_type/{{ t[0] }}" onclick="return confirmDelete();" class="delete-btn"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>


                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- PROPRIETAIRES -->
            <section id="proprietaires" class="content-section" style="display:none;">
                <h2>Gestion des Propri√©taires</h2>
                <form action="/add_proprietaire" method="POST" id="form-proprietaire">

                    <!-- utilis√© seulement pour modification -->
                    <input type="hidden" name="id_proprietaire" id="prop_id">

                    <label>Nom :</label>
                    <input type="text" name="nom_proprietaire" id="prop_nom" required><br>

                    <label>Type :</label>
                    <input type="text" name="type_proprietaire" id="prop_type" required><br>

                    <label>Contact :</label>
                    <input type="text" name="contact" id="prop_contact"><br>

                    <button type="submit" id="prop_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Propri√©taires</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Type</th>
                        <th>Contact</th>
                        <th>Modifier</th>
                        <th>Supprimer</th>
                    </tr>

                    {% for p in proprietaires %}
                    <tr>
                        <td>{{ p[0] }}</td>
                        <td>{{ p[1] }}</td>
                        <td>{{ p[2] }}</td>
                        <td>{{ p[3] }}</td>
                        <td>
                            <a href="#"
                                onclick="editProprietaire('{{ p[0] }}','{{ p[1] }}','{{ p[2] }}','{{ p[3] }}')"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>
                        <td>
                            <a href="/delete_proprietaire/{{ p[0] }}" onclick="return confirmDelete();"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>

                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- ETAT DE CONSERVATION -->
            <section id="etat_conservation" class="content-section" style="display:none;">
                <h2>√âtat de Conservation des B√¢timents</h2>

                <h3>Liste des √©tats</h3>
                <table>
                    <tr>
                        <th>B√¢timent</th>
                        <th>Date</th>
                        <th>√âtat</th>
                    </tr>
                    {% for e in etat_conservation %}
                    <tr>
                        <td>{{ e[0] }}</td>
                        <td>{{ e[1] }}</td>
                        <td>{{ e[2] }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </section>

            <!-- B√ÇTIMENTS -->
            <section id="batiments" class="content-section">
                <h2>Gestion des B√¢timents</h2>
                <div class="form-container">
                    <form action="/add_batiment" method="POST" id="form-batiment">

                        <!-- utilis√© seulement pour la modification -->
                        <input type="hidden" name="id_batiment" id="id_batiment">

                        <label>Nom :</label>
                        <input type="text" name="name" id="bat_nom" required><br>

                        <label>Ann√©e :</label>
                        <input type="number" name="year" id="bat_year" min="1800" max="2100" required><br>

                        <label>√âtat / Protection :</label>
                        <input type="text" name="etat" id="bat_etat" required><br>

                        <label>Latitude :</label>
                        <input type="text" name="latitude" id="bat_lat" required><br>

                        <label>Longitude :</label>
                        <input type="text" name="longitude" id="bat_lon" required><br>

                        <label>Adresse :</label>
                        <input type="text" name="adresse" id="bat_adresse" required><br>

                        <!-- ZONE -->
                        <label>Zone :</label>
                        <select name="zone" id="bat_zone">
                            <option value="">Aucune</option>
                            {% for z in zones %}
                            <option value="{{ z[0] }}">{{ z[1] }}</option>
                            {% endfor %}
                        </select><br>

                        <!-- TYPE -->
                        <label>Type :</label>
                        <select name="type" id="bat_type">
                            <option value="">Aucun</option>
                            {% for t in types %}
                            <option value="{{ t[0] }}">{{ t[1] }}</option>
                            {% endfor %}
                        </select><br>

                        <!-- PROPRI√âTAIRE -->
                        <label>Propri√©taire :</label>
                        <select name="proprietaire" id="bat_prop">
                            <option value="">Aucun</option>
                            {% for p in proprietaires %}
                            <option value="{{ p[0] }}">{{ p[1] }}</option>
                            {% endfor %}
                        </select><br>

                        <button type="submit" id="bat_submit_btn">Ajouter</button>


                    </form>


                    <h3>Liste des B√¢timents</h3>
                    <table>
                        <tr>
                            <th>ID</th>
                            <th>Nom</th>
                            <th>adresse</th>
                            <th>Latitude</th>
                            <th>Longitude</th>
                            <th>Ann√©e</th>
                            <th>√âtat</th>
                            <th>Zone</th>
                            <th>Type</th>
                            <th>Propri√©taire</th>
                            <th>Modefier</th>
                            <th>Supprimer</th>
                        </tr>

                        {% for b in batiments %}
                        <tr>
                            <td>{{ b[0] }}</td>
                            <td>{{ b[1] }}</td>
                            <td>{{ b[2] }}</td>
                            <td>{{ b[3] }}</td>
                            <td>{{ b[4] }}</td>
                            <td>{{ b[5] }}</td>
                            <td>{{ b[6] }}</td>
                            <td>{{ b[7] }}</td>
                            <td>{{ b[8] }}</td>
                            <td>{{ b[9] }}</td>
                            <td>
                                <a href="#" onclick="editBatiment(
        '{{ b[0] }}','{{ b[1] }}','{{ b[5] }}','{{ b[6] }}',
        '{{ b[3] }}','{{ b[4] }}','{{ b[2] }}',
        '{{ b[7] }}','{{ b[8] }}','{{ b[9] }}'
    )"><i class="fa-solid fa-pen-to-square edit-icon"></i></a>
                            </td>

                            <td>
                                <a href="/delete_batiment/{{ b[0] }}" onclick="return confirmDelete();"><i
                                        class="fa-solid fa-trash delete-icon"></i></a>
                            </td>


                        </tr>

                        {% endfor %}
                    </table>
            </section>

            <!-- PRESTATAIRES -->
            <section id="prestataires" class="content-section" style="display:none;">
                <h2>Gestion des Prestataires</h2>
                <form action="/add_prestataire" method="POST" id="form-prestataire">

                    <!-- utilis√© seulement pour modification -->
                    <input type="hidden" name="id_prestataire" id="pres_id">

                    <label>Nom :</label>
                    <input type="text" name="nom" id="pres_nom" required><br>

                    <label>Type :</label>
                    <input type="text" name="type" id="pres_type" required><br>

                    <label>Contact :</label>
                    <input type="text" name="contact" id="pres_contact"><br>

                    <button type="submit" id="pres_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Prestataires</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Type</th>
                        <th>Contact</th>
                        <th>Modifier</th>
                        <th>Supprimer</th>
                    </tr>

                    {% for p in prestataires %}
                    <tr>
                        <td>{{ p[0] }}</td>
                        <td>{{ p[1] }}</td>
                        <td>{{ p[2] }}</td>
                        <td>{{ p[3] }}</td>
                        <td>
                            <a href="#"
                                onclick="editPrestataire('{{ p[0] }}','{{ p[1] }}','{{ p[2] }}','{{ p[3] }}')"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>
                        <td>
                            <a href="/delete_prestataire/{{ p[0] }}" onclick="return confirmDelete();"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>


                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- INTERVENTIONS -->
            <section id="interventions" class="content-section" style="display:none;">
                <h2>Gestion des Interventions</h2>
                <form action="/add_intervention" method="POST" id="form-intervention">

                    <!-- utilis√© seulement pour modification -->
                    <input type="hidden" name="id_intervention" id="interv_id">

                    <label>B√¢timent :</label>
                    <select name="batiment" id="interv_batiment" required>
                        {% for b in batiments %}
                        <option value="{{ b[0] }}">{{ b[1] }}</option>
                        {% endfor %}
                    </select><br>

                    <label>Prestataire :</label>
                    <select name="prestataire" id="interv_prestataire" required>
                        {% for p in prestataires %}
                        <option value="{{ p[0] }}">{{ p[1] }}</option>
                        {% endfor %}
                    </select><br>

                    <label>Date travaux :</label>
                    <input type="date" name="date_travaux" id="interv_date" required><br>

                    <label>Type travaux :</label>
                    <input type="text" name="type_travaux" id="interv_type" required><br>

                    <label>Co√ªt :</label>
                    <input type="number" step="0.01" name="cout" id="interv_cout"><br>

                    <button type="submit" id="interv_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Interventions</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>B√¢timent</th>
                        <th>Prestataire</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Co√ªt</th>
                        <th>Modefier</th>
                        <th>Supprimer</th>
                    </tr>

                    {% for i in interventions %}
                    <tr>
                        <td>{{ i[0] }}</td>
                        <td>{{ i[1] }}</td>
                        <td>{{ i[2] }}</td>
                        <td>{{ i[3] }}</td>
                        <td>{{ i[4] }}</td>
                        <td>{{ i[5] }}</td>
                        <td>
                            <a href="#" onclick="editIntervention(... )"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>
                        <td>
                            <a href="/delete_intervention/{{ i[0] }}" onclick="return confirmDelete();"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>


                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- INSPECTIONS -->
            <section id="inspections" class="content-section" style="display:none;">
                <h2>Gestion des Inspections</h2>
                <form action="/add_inspection" method="POST" id="form-inspection">

                    <!-- utilis√© seulement pour modification -->
                    <input type="hidden" name="id_inspection" id="insp_id">

                    <label>B√¢timent :</label>
                    <select name="batiment" id="insp_batiment" required>
                        {% for b in batiments %}
                        <option value="{{ b[0] }}">{{ b[1] }}</option>
                        {% endfor %}
                    </select><br>

                    <label>Date inspection :</label>
                    <input type="date" name="date_inspection" id="insp_date" required><br>

                    <label>Rapport :</label>
                    <textarea name="rapport" id="insp_rapport"></textarea><br>

                    <button type="submit" id="insp_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Inspections</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>B√¢timent</th>
                        <th>Date</th>
                        <th>Rapport</th>
                        <th>Modifier</th>
                        <th>Supprimer</th>

                    </tr>

                    {% for ins in inspections %}
                    <tr>
                        <td>{{ ins[0] }}</td>
                        <td>{{ ins[1] }}</td>
                        <td>{{ ins[2] }}</td>
                        <td>{{ ins[3] }}</td>
                        <td>
                            <a href="#" onclick="editInspection(... )"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>
                        <td>
                            <a href="/delete_inspection/{{ ins[0] }}" onclick="return confirmDelete();"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>


                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- DOCUMENTS -->
            <section id="documents" class="content-section" style="display:none;">
                <h2>Gestion des Documents</h2>
                <form action="/add_document" method="POST" id="form-document">

                    <!-- utilis√© seulement pour modification -->
                    <input type="hidden" name="id_doc" id="doc_id">

                    <label>B√¢timent :</label>
                    <select name="batiment" id="doc_batiment" required>
                        {% for b in batiments %}
                        <option value="{{ b[0] }}">{{ b[1] }}</option>
                        {% endfor %}
                    </select><br>

                    <label>Chemin / Nom fichier :</label>
                    <input type="text" name="chemin" id="doc_chemin" required><br>

                    <label>Type document :</label>
                    <input type="text" name="type_doc" id="doc_type"><br>

                    <button type="submit" id="doc_submit_btn">Ajouter</button>
                </form>


                <h3>Liste des Documents</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>B√¢timent</th>
                        <th>Chemin</th>
                        <th>Type</th>
                        <th>Modefier</th>
                        <th>Supprimer</th>
                    </tr>

                    {% for d in documents %}
                    <tr>
                        <td>{{ d[0] }}</td>
                        <td>{{ d[1] }}</td>
                        <td>{{ d[2] }}</td>
                        <td>{{ d[3] }}</td>
                        <td>
                            <a href="#" onclick="editDocument(... )"><i
                                    class="fa-solid fa-pen-to-square edit-icon"></i></a>
                        </td>
                        <td>
                            <a href="/delete_document/{{ d[0] }}" onclick="return confirmDelete();"><i
                                    class="fa-solid fa-trash delete-icon"></i></a>
                        </td>


                    </tr>

                    {% endfor %}
                </table>
            </section>

            <!-- RAPPORTS -->
            <section id="rapports" class="content-section">
                <h2>Rapports et Synth√®ses</h2>
                <p>
                    Cette section donne acc√®s aux rapports d√©taill√©s sur l‚Äô√©tat du patrimoine,
                    les interventions, les prestataires et les co√ªts par quartier.
                </p>
                <p>
                    <a href="/rapports" id="cli">Cliquer ici pour voir les rapports d√©taill√©s</a>
                </p>
            </section>
        </div>
    </div>

    <!-- ========= SCRIPTS ========= -->

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>

        /* ======================================================
       =============     CARTE LEAFLET RABAT     ============
       ====================================================== */

        /* ----------- CARTE LIMIT√âE √Ä RABAT ----------- */

        // Limites g√©ographiques exactes de Rabat (de T√©mara au Bouregreg)
        const rabatBounds = L.latLngBounds(
            [33.940, -6.950],   // Sud-Ouest
            [34.120, -6.680]    // Nord-Est
        );

        // Cr√©ation de la carte
        const map = L.map('map', {
            maxBounds: rabatBounds,
            maxBoundsViscosity: 1.0,
            minZoom: 12,
            maxZoom: 18
        }).setView([34.020, -6.820], 13);

        // Fond de carte OSM
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: "¬© OpenStreetMap contributors"
        }).addTo(map);


        /* === LAYERS === */
        const monuments = L.layerGroup();
        const buildings = L.layerGroup();
        const jardins = L.layerGroup();


        /* ======================================================
           =============         MONUMENTS          ==============
           ====================================================== */
        const monumentsData = [{ name: "Tour Hassan", lat: 34.024259, long: -6.822222 }, { name: "Mausol√©e Mohammed V", lat: 34.022805, long: -6.822462 }, { name: "Kasbah des Oudayas", lat: 34.031287, long: -6.836695 }, { name: "Chellah", lat: 34.010873, long: -6.820784 }, { name: "Bab Rouah", lat: 34.017884, long: -6.842290 }, { name: "Mus√©e Mohammed VI d‚ÄôArt Moderne", lat: 34.015145, long: -6.830646 }, { name: "Ancienne M√©dina de Rabat", lat: 34.026836, long: -6.837039 }, { name: "Bab El Had", lat: 34.022449, long: -6.837110 }, { name: "Bab Ouda√Øa", lat: 34.030713, long: -6.840454 }];
        monumentsData.forEach(m =>
            L.marker([m.lat, m.long]).bindPopup("üèõÔ∏è <b>" + m.name + "</b>").addTo(monuments)
        );


        /* ======================================================
           =============            JARDINS          =============
           ====================================================== */
        const jardinsData = [{ name: "Jardin d‚ÄôEssais Botaniques", lat: 34.002600, long: -6.846900 }, { name: "For√™t Ibn Sina (Hilton)", lat: 34.007500, long: -6.867300 }, { name: "Jardin Nouzhat Hassan", lat: 34.019900, long: -6.836000 }, { name: "Parc Hassan II", lat: 34.015900, long: -6.824600 }, { name: "Jardins Exotiques Bouknadel", lat: 34.140300, long: -6.663100 }, { name: "Parc Zoologique de Rabat", lat: 33.977500, long: -6.866900 }, { name: "Jardin Tour Hassan", lat: 34.024200, long: -6.821500 }, { name: "Jardin de l‚ÄôAgdal", lat: 34.010800, long: -6.836900 }, { name: "Parc Oudayas", lat: 34.027900, long: -6.841400 }, { name: "Jardin Ibn Rochd", lat: 34.020300, long: -6.832500 }];
        jardinsData.forEach(j =>
            L.marker([j.lat, j.long]).bindPopup("üå≥ <b>" + j.name + "</b>").addTo(jardins)
        );


        /* ======================================================
           ===========     B√ÇTIMENTS ADMINISTRATIFS     ==========
           ====================================================== */
        const buildingsData = [{ name: "Parlement du Maroc", lat: 34.019000, long: -6.836000 }, { name: "Minist√®re de l‚ÄôInt√©rieur", lat: 34.018200, long: -6.832000 }, { name: "Gare Rabat Agdal", lat: 34.002000, long: -6.836000 }, { name: "Gare Rabat Ville", lat: 34.020000, long: -6.836000 }, { name: "H√¥pital Avicenne", lat: 34.006000, long: -6.855000 }, { name: "H√¥pital Ibn Sina", lat: 34.005000, long: -6.850000 }, { name: "Palais Royal", lat: 34.005000, long: -6.824000 }, { name: "Si√®ge du Gouvernement", lat: 34.018000, long: -6.829000 }];

        buildingsData.forEach(b =>
            L.marker([b.lat, b.long]).bindPopup("üè¢ <b>" + b.name + "</b>").addTo(buildings)
        );


        /* ======================================================
           =============   AFFICHAGE PAR D√âFAUT   ===============
           ====================================================== */
        monuments.addTo(map);
        buildings.addTo(map);
        jardins.addTo(map);


        /* ======================================================
           =============      FILTRES RADIO CARTE      ==========
           ====================================================== */

        document.querySelectorAll("input[name='filter']").forEach(radio => {

            radio.addEventListener("change", function () {

                switch (this.value) {

                    case "all":
                        monuments.addTo(map);
                        buildings.addTo(map);
                        jardins.addTo(map);
                        break;

                    case "monuments":
                        map.removeLayer(buildings);
                        map.removeLayer(jardins);
                        monuments.addTo(map);
                        break;

                    case "batiments":
                        map.removeLayer(monuments);
                        map.removeLayer(jardins);
                        buildings.addTo(map);
                        break;

                    case "jardins":
                        map.removeLayer(monuments);
                        map.removeLayer(buildings);
                        jardins.addTo(map);
                        break;
                }
            });

        });


        /* ======================================================
                üìå GESTION DES SECTIONS (MENU)
           ====================================================== */

        function openSection(id) {

            document.querySelectorAll(".content-section").forEach(sec => {
                sec.style.display = "none";
            });

            const el = document.getElementById(id);
            if (el) el.style.display = "block";
        }

        document.addEventListener("DOMContentLoaded", () => {
            openSection('zones');
        });


        /* ======================================================
                üìå FONCTION MODIFIER B√ÇTIMENT
           ====================================================== */

        function editBatiment(id, nom, year, etat, lat, lon, adresse, zone, type, prop) {

            openSection('batiments');  // ouvrir section b√¢timents

            const form = document.getElementById("form-batiment");
            form.action = "/update_batiment";

            document.getElementById("id_batiment").value = id;
            document.getElementById("bat_nom").value = nom;
            document.getElementById("bat_year").value = year;
            document.getElementById("bat_etat").value = etat;
            document.getElementById("bat_lat").value = lat;
            document.getElementById("bat_lon").value = lon;
            document.getElementById("bat_adresse").value = adresse;
            document.getElementById("bat_zone").value = zone;
            document.getElementById("bat_type").value = type;
            document.getElementById("bat_prop").value = prop;

            document.getElementById("bat_submit_btn").innerText = "Modifier";
        }


        /* ======================================================
                üìå RESET FORMULAIRE B√ÇTIMENT
           ====================================================== */

        function resetBatimentForm() {

            const form = document.getElementById("form-batiment");
            form.reset();
            form.action = "/add_batiment";

            document.getElementById("id_batiment").value = "";
            document.getElementById("bat_submit_btn").innerText = "Ajouter";
        }


    </script>

    <script>
        function editBatiment(
            id, nom, year, etat,
            lat, lon, adresse,
            zone, type, prop
        ) {
            // afficher la section b√¢timents
            openSection('batiments');

            // changer action du formulaire
            const form = document.getElementById("form-batiment");
            form.action = "/update_batiment";

            // remplir les champs
            document.getElementById("id_batiment").value = id;
            document.getElementById("bat_nom").value = nom;
            document.getElementById("bat_year").value = year;
            document.getElementById("bat_etat").value = etat;
            document.getElementById("bat_lat").value = lat;
            document.getElementById("bat_lon").value = lon;
            document.getElementById("bat_adresse").value = adresse;
            document.getElementById("bat_zone").value = zone;
            document.getElementById("bat_type").value = type;
            document.getElementById("bat_prop").value = prop;
            // passer en mode modification
            document.getElementById("bat_submit_btn").innerText = "Modifier";

        }
        // passer en mode modification

        function resetBatimentForm() {
            const form = document.getElementById("form-batiment");
            form.reset();
            form.action = "/add_batiment";

            document.getElementById("id_batiment").value = "";
            document.getElementById("bat_submit_btn").innerText = "Ajouter";
        }

    </script>

    <script>
        function openSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(s => s.style.display = "none");
            document.getElementById(sectionId).style.display = "block";

            // Reset active buttons
            document.querySelectorAll(".menu-sections button")
                .forEach(btn => btn.classList.remove("active"));

            // Activate clicked button
            event.target.classList.add("active");
        }

        function editZone(id, nom) {
            openSection('zones');

            document.getElementById("form-zone").action = "/update_zone";
            document.getElementById("zone_id").value = id;
            document.getElementById("zone_nom").value = nom;
            document.getElementById("zone_submit_btn").innerText = "Modifier";
        }

        function resetZoneForm() {
            document.getElementById("form-zone").reset();
            document.getElementById("form-zone").action = "/add_zone";
            document.getElementById("zone_submit_btn").innerText = "Ajouter";
        }
    </script>



    <script>
        function editProprietaire(id, nom, type, contact) {
            openSection('proprietaires');

            const form = document.getElementById("form-proprietaire");
            form.action = "/update_proprietaire";

            document.getElementById("prop_id").value = id;
            document.getElementById("prop_nom").value = nom;
            document.getElementById("prop_type").value = type;
            document.getElementById("prop_contact").value = contact || "";

            document.getElementById("prop_submit_btn").innerText = "Modifier";
        }

        function resetProprietaireForm() {
            const form = document.getElementById("form-proprietaire");
            form.reset();
            form.action = "/add_proprietaire";

            document.getElementById("prop_id").value = "";
            document.getElementById("prop_submit_btn").innerText = "Ajouter";
        }
    </script>

    <script>
        function editType(id, libelle) {
            openSection('types');

            const form = document.getElementById("form-type");
            form.action = "/update_type";

            document.getElementById("type_id").value = id;
            document.getElementById("type_libelle").value = libelle;

            document.getElementById("type_submit_btn").innerText = "Modifier";
        }

        function resetTypeForm() {
            const form = document.getElementById("form-type");
            form.reset();
            form.action = "/add_type";

            document.getElementById("type_id").value = "";
            document.getElementById("type_submit_btn").innerText = "Ajouter";
        }
    </script>

    <script>
        function editPrestataire(id, nom, type, contact) {
            openSection('prestataires');

            const form = document.getElementById("form-prestataire");
            form.action = "/update_prestataire";

            document.getElementById("pres_id").value = id;
            document.getElementById("pres_nom").value = nom;
            document.getElementById("pres_type").value = type;
            document.getElementById("pres_contact").value = contact || "";

            document.getElementById("pres_submit_btn").innerText = "Modifier";
        }

        function resetPrestataireForm() {
            const form = document.getElementById("form-prestataire");
            form.reset();
            form.action = "/add_prestataire";

            document.getElementById("pres_id").value = "";
            document.getElementById("pres_submit_btn").innerText = "Ajouter";
        }
    </script>


    <script>
        function editIntervention(id, batimentNom, prestataireNom, date, typeTravaux, cout) {
            openSection('interventions');

            const form = document.getElementById("form-intervention");
            form.action = "/update_intervention";

            // remplir champs simples
            document.getElementById("interv_id").value = id;
            document.getElementById("interv_date").value = date;
            document.getElementById("interv_type").value = typeTravaux;
            document.getElementById("interv_cout").value = cout || "";

            // s√©lectionner b√¢timent par nom
            const batSelect = document.getElementById("interv_batiment");
            for (let opt of batSelect.options) {
                if (opt.text === batimentNom) {
                    opt.selected = true;
                    break;
                }
            }

            // s√©lectionner prestataire par nom
            const presSelect = document.getElementById("interv_prestataire");
            for (let opt of presSelect.options) {
                if (opt.text === prestataireNom) {
                    opt.selected = true;
                    break;
                }
            }

            // bouton en mode modification
            document.getElementById("interv_submit_btn").innerText = "Modifier";
        }

        function resetInterventionForm() {
            const form = document.getElementById("form-intervention");
            form.reset();
            form.action = "/add_intervention";

            document.getElementById("interv_id").value = "";
            document.getElementById("interv_submit_btn").innerText = "Ajouter";
        }
    </script>

    <script>
        function editInspection(id, batimentNom, date, rapport) {
            openSection('inspections');

            const form = document.getElementById("form-inspection");
            form.action = "/update_inspection";

            document.getElementById("insp_id").value = id;
            document.getElementById("insp_date").value = date;
            document.getElementById("insp_rapport").value = rapport || "";

            // s√©lectionner b√¢timent par nom
            const batSelect = document.getElementById("insp_batiment");
            for (let opt of batSelect.options) {
                if (opt.text === batimentNom) {
                    opt.selected = true;
                    break;
                }
            }

            document.getElementById("insp_submit_btn").innerText = "Modifier";
        }

        function resetInspectionForm() {
            const form = document.getElementById("form-inspection");
            form.reset();
            form.action = "/add_inspection";

            document.getElementById("insp_id").value = "";
            document.getElementById("insp_submit_btn").innerText = "Ajouter";
        }
    </script>

    <script>
        function editDocument(id, batimentNom, chemin, typeDoc) {
            openSection('documents');

            const form = document.getElementById("form-document");
            form.action = "/update_document";

            document.getElementById("doc_id").value = id;
            document.getElementById("doc_chemin").value = chemin;
            document.getElementById("doc_type").value = typeDoc || "";

            // s√©lectionner b√¢timent par nom
            const batSelect = document.getElementById("doc_batiment");
            for (let opt of batSelect.options) {
                if (opt.text === batimentNom) {
                    opt.selected = true;
                    break;
                }
            }

            document.getElementById("doc_submit_btn").innerText = "Modifier";
        }

        function resetDocumentForm() {
            const form = document.getElementById("form-document");
            form.reset();
            form.action = "/add_document";

            document.getElementById("doc_id").value = "";
            document.getElementById("doc_submit_btn").innerText = "Ajouter";
        }
    </script>
    <script>
        function confirmDelete() {
            return confirm("‚ùó Voulez-vous vraiment supprimer cet √©l√©ment ?");
        }
    </script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("overlay");
            const content = document.getElementById("page-content");

            sidebar.classList.toggle("open");
            overlay.classList.toggle("active");
            content.classList.toggle("blur");
        }
    </script>








</body>
<div id="overlay" class="overlay" onclick="toggleSidebar()"></div>


<!-- ================== SIDEBAR ================== -->
<div id="overlay" class="overlay" onclick="toggleSidebar()"></div>


<div id="sidebar" class="sidebar">
    <div class="toggle-btn" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
    </div>

    <div class="menu">

        <div class="item" onclick="window.location.href='{{ url_for('index') }}'">
            <i class="fa-solid fa-house"></i>
            <span>Accueil</span>
        </div>

        <div class="item" onclick="window.location.href='{{ url_for('rapports') }}'">
            <i class="fa-solid fa-chart-line"></i>
            <span>Rapports</span>
        </div>

        <div class="item" onclick="window.location.href='{{ url_for('maintenance') }}'">
            <i class="fa-solid fa-screwdriver-wrench"></i>
            <span>Maintenance</span>
        </div>

        <div class="item" onclick="window.location.href='{{ url_for('support') }}'">
            <i class="fa-solid fa-headset"></i>
            <span>Support</span>
        </div>

        <div class="item" onclick="window.location.href='{{ url_for('logout') }}'">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>D√©connexion</span>
        </div>

    </div>
</div>


<div id="page-content">
    <!-- ton contenu -->
</div>

</div>

<div id="page-content">
    <!-- contenu -->
</div>



</html>