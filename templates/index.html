<<!DOCTYPE html>
    <html lang="fr">

    <head>
        <meta charset="UTF-8">
        <title>Gestion Patrimoine + Carte Rabat</title>

        <!-- CSS Leaflet -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <!-- Ton CSS Flask -->
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>

    <body>

        <!-- ========= SECTION CARTE ========= -->
        <header>
            <span id="ci">Rabat ‚Äì Syst√®me d'information urbain</span>
            <h1>üó∫ Cartographie du patrimoine de Rabat</h1>
            <p>Monuments, b√¢timents administratifs et jardins</p>
        </header>

        <!-- Boutons de filtre de la CARTE -->
        <div class="controls">
            <button class="btn" onclick="showAll()">üåç Tout afficher</button>
            <button class="btn" onclick="showMonuments()">üèõ Monuments</button>
            <button class="btn" onclick="showBuildings()">üè¢ B√¢timents</button>
            <button class="btn" onclick="showJardins()">üå≥ Jardins</button>
        </div>

        <!-- Conteneur de la carte -->
        <div id="map"></div>
        <!-- ========= MENU PRINCIPAL DES SECTIONS ========= -->
        <div class="menu-sections">
            <button onclick="openSection('batiments')">üèõ B√¢timents</button>
            <button onclick="openSection('prestataires')">üß± Prestataires</button>
            <button onclick="openSection('interventions')">üõ† Interventions</button>
            <button onclick="openSection('inspections')">üîç Inspections</button>
            <button onclick="openSection('documents')">üìÑ Documents</button>
            <button onclick="openSection('zones')">üåç Zones</button>
            <button onclick="openSection('types')">üèó Types de B√¢timent</button>
            <button onclick="openSection('proprietaires')">üë§ Propri√©taires</button>
            <button onclick="openSection('etat_conservation')">üìå √âtat Conservation</button>
            <button onclick="openSection('rapports')">üìä Rapports</button>
        </div>

        <!-- ========= SECTIONS CONTENU ========= -->

        <!-- ZONES -->
        <section id="zones" class="content-section" style="display:none;">
            <h2>Gestion des Zones</h2>

            <h3>Ajouter une zone</h3>
            <form action="/add_zone" method="POST">
                <label>Nom Zone:</label><input type="text" name="nom_zone" required><br>
                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Zones</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                </tr>
                {% for z in zones %}
                <tr>
                    <td>{{ z[0] }}</td>
                    <td>{{ z[1] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- TYPES DE BATIMENT -->
        <section id="types" class="content-section" style="display:none;">
            <h2>Gestion des Types de B√¢timent</h2>

            <h3>Ajouter un type</h3>
            <form action="/add_type" method="POST">
                <label>Libell√©:</label><input type="text" name="libelle" required><br>
                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Types</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>Libell√©</th>
                </tr>
                {% for t in types %}
                <tr>
                    <td>{{ t[0] }}</td>
                    <td>{{ t[1] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- PROPRIETAIRES -->
        <section id="proprietaires" class="content-section" style="display:none;">
            <h2>Gestion des Propri√©taires</h2>

            <h3>Ajouter un propri√©taire</h3>
            <form action="/add_proprietaire" method="POST">
                <label>Nom:</label><input type="text" name="nom_proprietaire" required><br>
                <label>Type:</label><input type="text" name="type_proprietaire" required><br>
                <label>Contact:</label><input type="text" name="contact"><br>
                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Propri√©taires</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Type</th>
                    <th>Contact</th>
                </tr>
                {% for p in proprietaires %}
                <tr>
                    <td>{{ p[0] }}</td>
                    <td>{{ p[1] }}</td>
                    <td>{{ p[2] }}</td>
                    <td>{{ p[3] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- ETAT DE CONSERVATION -->
        <section id="etat_conservation" class="content-section" style="display:none;">
            <h2>√âtat de Conservation des B√¢timents</h2>

            <h3>Liste des √©tats</h3>
            <table>
                <tr>
                    <th>B√¢timent</th>
                    <th>Date</th>
                    <th>√âtat</th>
                </tr>
                {% for e in etat_conservation %}
                <tr>
                    <td>{{ e[0] }}</td>
                    <td>{{ e[1] }}</td>
                    <td>{{ e[2] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- B√ÇTIMENTS -->
        <section id="batiments" class="content-section">
            <h2>Gestion des B√¢timents</h2>
            <div class="form-container">
                <h3>Ajouter un b√¢timent</h3>
                <form action="/add_batiment" method="POST">
                    <label>Nom:</label><input type="text" name="name" required><br>
                    <label>Ann√©e:</label><input type="number" name="year" min="1800" max="2100" required><br>
                    <label>√âtat / Protection:</label><input type="text" name="etat" required><br>
                    <label>Latitude:</label><input type="text" name="latitude" required><br>
                    <label>Longitude:</label><input type="text" name="longitude" required><br>
                    <label>Adresse:</label><input type="text" name="adresse" required><br>
                    <label>Zone:</label>
                    <select name="zone">
                        <option value="">Aucune</option>
                        {% for z in zones %}
                        <option value="{{ z[0] }}">{{ z[1] }}</option>
                        {% endfor %}
                    </select><br>
                    <label>Type:</label>
                    <select name="type">
                        <option value="">Aucune</option>
                        {% for t in types %}
                        <option value="{{ t[0] }}">{{ t[1] }}</option>
                        {% endfor %}
                    </select><br>
                    <label>Propri√©taire:</label>
                    <select name="proprietaire">
                        <option value="">Aucune</option>
                        {% for p in proprietaires %}
                        <option value="{{ p[0] }}">{{ p[1] }}</option>
                        {% endfor %}
                    </select><br>
                    <button type="submit">Ajouter</button>

                </form>

                <h3>Liste des B√¢timents</h3>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>adresse </th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th>Ann√©e</th>
                        <th>√âtat</th>
                        <th>Zone</th>
                        <th>Type</th>
                        <th>Propri√©taire</th>
                    </tr>
                    {% for b in batiments %}
                    <tr>
                        <td>{{ b[0] }}</td>
                        <td>{{ b[1] }}</td>
                        <td>{{ b[2] }}</td>
                        <td>{{ b[3] }}</td>
                        <td>{{ b[4] }}</td>
                        <td>{{ b[5] }}</td>
                        <td>{{ b[6] }}</td>
                        <td>{{ b[7] }}</td>
                        <td>{{ b[8] }}</td>
                        <td>{{ b[9] }}</td>



                    </tr>
                    {% endfor %}
                </table>
        </section>

        <!-- PRESTATAIRES -->
        <section id="prestataires" class="content-section" style="display:none;">
            <h2>Gestion des Prestataires</h2>

            <h3>Ajouter un prestataire</h3>
            <form action="/add_prestataire" method="POST">
                <label>Nom:</label><input type="text" name="nom" required><br>
                <label>Type:</label><input type="text" name="type" required><br>
                <label>Contact:</label><input type="text" name="contact"><br>
                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Prestataires</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Type</th>
                    <th>Contact</th>
                </tr>
                {% for p in prestataires %}
                <tr>
                    <td>{{ p[0] }}</td>
                    <td>{{ p[1] }}</td>
                    <td>{{ p[2] }}</td>
                    <td>{{ p[3] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- INTERVENTIONS -->
        <section id="interventions" class="content-section" style="display:none;">
            <h2>Gestion des Interventions</h2>

            <h3>Ajouter une intervention</h3>
            <form action="/add_intervention" method="POST">
                <label>B√¢timent:</label>
                <select name="batiment">
                    {% for b in batiments %}
                    <option value="{{ b[0] }}">{{ b[1] }}</option>
                    {% endfor %}
                </select><br>

                <label>Prestataire:</label>
                <select name="prestataire">
                    {% for p in prestataires %}
                    <option value="{{ p[0] }}">{{ p[1] }}</option>
                    {% endfor %}
                </select><br>

                <label>Date:</label><input type="date" name="date_travaux" required><br>
                <label>Type travaux:</label><input type="text" name="type_travaux" required><br>
                <label>Co√ªt:</label><input type="number" step="0.01" name="cout"><br>

                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Interventions</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>B√¢timent</th>
                    <th>Prestataire</th>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Co√ªt</th>
                </tr>
                {% for i in interventions %}
                <tr>
                    <td>{{ i[0] }}</td>
                    <td>{{ i[1] }}</td>
                    <td>{{ i[2] }}</td>
                    <td>{{ i[3] }}</td>
                    <td>{{ i[4] }}</td>
                    <td>{{ i[5] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- INSPECTIONS -->
        <section id="inspections" class="content-section" style="display:none;">
            <h2>Gestion des Inspections</h2>

            <h3>Ajouter une inspection</h3>
            <form action="/add_inspection" method="POST">
                <label>B√¢timent:</label>
                <select name="batiment">
                    {% for b in batiments %}
                    <option value="{{ b[0] }}">{{ b[1] }}</option>
                    {% endfor %}
                </select><br>

                <label>Date:</label><input type="date" name="date_inspection" required><br>
                <label>Rapport:</label><textarea name="rapport"></textarea><br>

                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Inspections</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>B√¢timent</th>
                    <th>Date</th>
                    <th>Rapport</th>
                </tr>
                {% for ins in inspections %}
                <tr>
                    <td>{{ ins[0] }}</td>
                    <td>{{ ins[1] }}</td>
                    <td>{{ ins[2] }}</td>
                    <td>{{ ins[3] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- DOCUMENTS -->
        <section id="documents" class="content-section" style="display:none;">
            <h2>Gestion des Documents</h2>

            <h3>Ajouter un document</h3>
            <form action="/add_document" method="POST">
                <label>B√¢timent:</label>
                <select name="batiment">
                    {% for b in batiments %}
                    <option value="{{ b[0] }}">{{ b[1] }}</option>
                    {% endfor %}
                </select><br>

                <label>Chemin / Nom fichier:</label><input type="text" name="chemin" required><br>
                <label>Type document:</label><input type="text" name="type_doc"><br>

                <button type="submit">Ajouter</button>
            </form>

            <h3>Liste des Documents</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>B√¢timent</th>
                    <th>Chemin</th>
                    <th>Type</th>
                </tr>
                {% for d in documents %}
                <tr>
                    <td>{{ d[0] }}</td>
                    <td>{{ d[1] }}</td>
                    <td>{{ d[2] }}</td>
                    <td>{{ d[3] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <!-- RAPPORTS -->
        <section id="rapports" class="content-section">
            <h2>Rapports et Synth√®ses</h2>
            <p>
                Cette section donne acc√®s aux rapports d√©taill√©s sur l‚Äô√©tat du patrimoine,
                les interventions, les prestataires et les co√ªts par quartier.
            </p>
            <p>
                üëâ <a href="/rapports">Cliquer ici pour voir les rapports d√©taill√©s</a>
            </p>
        </section>
        </div>

        <!-- ========= SCRIPTS ========= -->

        <!-- Leaflet JS -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <script>

            /* ------ Gestion des sections (menu) ------ */
            function openSection(id) {
                document.querySelectorAll(".content-section").forEach(sec => {
                    sec.style.display = "none";
                });
                const el = document.getElementById(id);
                if (el) el.style.display = "block";
            }
            openSection('batiments');  // Section par d√©faut

            /* ======================================================
               =============     CARTE LEAFLET RABAT     ============
               ====================================================== */

            /* ----------- CARTE LIMIT√âE √Ä RABAT ----------- */

            // Limites g√©ographiques exactes de Rabat (de T√©mara au Bouregreg)
            const rabatBounds = L.latLngBounds(
                [33.940, -6.950],   // Sud-Ouest
                [34.120, -6.680]    // Nord-Est
            );

            // Cr√©ation de la carte
            const map = L.map('map', {
                maxBounds: rabatBounds,          // Emp√™che de sortir de Rabat
                maxBoundsViscosity: 1.0,         // Rebond doux sur les limites
                minZoom: 12,                     // Emp√™che de trop d√©zoomer
                maxZoom: 18
            }).setView([34.020, -6.820], 13);    // Centre parfait de Rabat

            // Fond de carte OSM
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                attribution: "¬© OpenStreetMap contributors"
            }).addTo(map);


            /* === LAYERS === */
            const monuments = L.layerGroup();
            const buildings = L.layerGroup();
            const jardins = L.layerGroup();


            /* ======================================================
               =============         MONUMENTS          ==============
               ====================================================== */
            const monumentsData = [
                { name: "Tour Hassan", lat: 34.024259, long: -6.822222 },
                { name: "Mausol√©e Mohammed V", lat: 34.022805, long: -6.822462 },
                { name: "Kasbah des Oudayas", lat: 34.031287, long: -6.836695 },
                { name: "Chellah", lat: 34.010873, long: -6.820784 },
                { name: "Bab Rouah", lat: 34.017884, long: -6.842290 },
                { name: "Mus√©e Mohammed VI d‚ÄôArt Moderne", lat: 34.015145, long: -6.830646 },
                { name: "Ancienne M√©dina de Rabat", lat: 34.026836, long: -6.837039 },
                { name: "Bab El Had", lat: 34.022449, long: -6.837110 },
                { name: "Bab Ouda√Øa", lat: 34.030713, long: -6.840454 }
            ];

            monumentsData.forEach(m =>
                L.marker([m.lat, m.long]).bindPopup("üèõÔ∏è <b>" + m.name + "</b>").addTo(monuments)
            );


            /* ======================================================
               =============            JARDINS          =============
               ====================================================== */
            const jardinsData = [
                { name: "Jardin d‚ÄôEssais Botaniques", lat: 34.002600, long: -6.846900 },
                { name: "For√™t Ibn Sina (Hilton)", lat: 34.007500, long: -6.867300 },
                { name: "Jardin Nouzhat Hassan", lat: 34.019900, long: -6.836000 },
                { name: "Parc Hassan II", lat: 34.015900, long: -6.824600 },
                { name: "Jardins Exotiques Bouknadel", lat: 34.140300, long: -6.663100 },
                { name: "Parc Zoologique de Rabat", lat: 33.977500, long: -6.866900 },
                { name: "Jardin Tour Hassan", lat: 34.024200, long: -6.821500 },
                { name: "Jardin de l‚ÄôAgdal", lat: 34.010800, long: -6.836900 },
                { name: "Parc Oudayas", lat: 34.027900, long: -6.841400 },
                { name: "Jardin Ibn Rochd", lat: 34.020300, long: -6.832500 }
            ];
            jardinsData.forEach(j =>
                L.marker([j.lat, j.long]).bindPopup("üå≥ <b>" + j.name + "</b>").addTo(jardins)
            );


            /* ======================================================
               ===========    B√ÇTIMENTS ADMINISTRATIFS    ===========
               ====================================================== */
            const buildingsData = [
                { name: "Parlement du Maroc", lat: 34.019000, long: -6.836000 },
                { name: "Minist√®re de l‚ÄôInt√©rieur", lat: 34.018200, long: -6.832000 },
                { name: "Gare Rabat Agdal", lat: 34.002000, long: -6.836000 },
                { name: "Gare Rabat Ville", lat: 34.020000, long: -6.836000 },
                { name: "H√¥pital Avicenne", lat: 34.006000, long: -6.855000 },
                { name: "H√¥pital Ibn Sina", lat: 34.005000, long: -6.850000 },
                { name: "Palais Royal", lat: 34.005000, long: -6.824000 },
                { name: "Si√®ge du Gouvernement", lat: 34.018000, long: -6.829000 }
            ];
            buildingsData.forEach(b =>
                L.marker([b.lat, b.long]).bindPopup("üè¢ <b>" + b.name + "</b>").addTo(buildings)
            );


            /* ======================================================
               =============   AFFICHAGE PAR D√âFAUT   ===============
               ====================================================== */
            monuments.addTo(map);
            buildings.addTo(map);
            jardins.addTo(map);


            /* ======================================================
               =============        FILTRES CARTE        =============
               ====================================================== */

            function showAll() {
                monuments.addTo(map);
                buildings.addTo(map);
                jardins.addTo(map);
            }

            function showMonuments() {
                map.removeLayer(buildings);
                map.removeLayer(jardins);
                monuments.addTo(map);
            }

            function showBuildings() {
                map.removeLayer(monuments);
                map.removeLayer(jardins);
                buildings.addTo(map);
            }

            function showJardins() {
                map.removeLayer(monuments);
                map.removeLayer(buildings);
                jardins.addTo(map);
            }

        </script>

    </body>

    </html>